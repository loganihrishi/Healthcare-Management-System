<html>
<head>
<title>AppDetailsGUI.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
AppDetailsGUI.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">ui.gui</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">model.Appointment</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">model.Patient</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">javax.swing.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.awt.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.awt.event.ActionEvent</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.awt.event.ActionListener</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.io.IOException</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.time.LocalDate</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.time.LocalTime</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.time.format.DateTimeFormatter</span><span class="s0">;</span>
<span class="s2">/**</span>
 <span class="s2">* This class represents the GUI of the add appointment feature of the main GUI.</span>
 <span class="s2">*/</span>

<span class="s0">public class </span><span class="s1">AppDetailsGUI </span><span class="s0">extends </span><span class="s1">StartApplicationGUI {</span>

    <span class="s3">// EFFECTS: starts the add appointment GUI</span>
    <span class="s0">public </span><span class="s1">AppDetailsGUI() </span><span class="s0">throws </span><span class="s1">IOException {</span>
        <span class="s0">super</span><span class="s1">()</span><span class="s0">;</span>
        <span class="s1">addAppointment()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s3">// MODIFIES: this</span>
    <span class="s3">// EFFECTS: adds the appointment if possible, displays appropriate error message otherwise</span>

    <span class="s0">private void </span><span class="s1">addAppointment() {</span>
        <span class="s1">JFrame frame = </span><span class="s0">new </span><span class="s1">JFrame(</span><span class="s4">&quot;Add an Appointment&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JLabel dateLabel = </span><span class="s0">new </span><span class="s1">JLabel(</span><span class="s4">&quot;Date (yyyy/mm/dd):&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JTextField dateField = </span><span class="s0">new </span><span class="s1">JTextField()</span><span class="s0">;</span>
        <span class="s1">dateField.setEditable(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JLabel timeLabel = </span><span class="s0">new </span><span class="s1">JLabel(</span><span class="s4">&quot;Time (hh:mm):&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JTextField timeField = </span><span class="s0">new </span><span class="s1">JTextField()</span><span class="s0">;</span>
        <span class="s1">timeField.setEditable(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JLabel phnLabel = </span><span class="s0">new </span><span class="s1">JLabel(</span><span class="s4">&quot;Personal Health Number:&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JTextField phnField = </span><span class="s0">new </span><span class="s1">JTextField()</span><span class="s0">;</span>
        <span class="s1">phnField.setEditable(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">JButton submitButton = </span><span class="s0">new </span><span class="s1">JButton(</span><span class="s4">&quot;Submit&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">submitButton.addActionListener(</span><span class="s0">new </span><span class="s1">ActionListener() {</span>
            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">actionPerformed(ActionEvent e) {</span>
                <span class="s1">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(</span><span class="s4">&quot;yyyy/MM/dd&quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">LocalDate date = LocalDate.parse(dateField.getText()</span><span class="s0">, </span><span class="s1">formatter)</span><span class="s0">;</span>
                <span class="s1">LocalTime time = LocalTime.parse(timeField.getText() + </span><span class="s4">&quot;:00&quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">Patient patient = getPatientFromPHN(Integer.parseInt(phnField.getText()))</span><span class="s0">;</span>
                <span class="s1">handlePatient(patient</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">phnField</span><span class="s0">, </span><span class="s1">date</span><span class="s0">, </span><span class="s1">time)</span><span class="s0">;</span>
                <span class="s1">clearFields(dateField</span><span class="s0">, </span><span class="s1">timeField</span><span class="s0">, </span><span class="s1">phnField)</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>
        <span class="s1">makePanel(dateLabel</span><span class="s0">, </span><span class="s1">dateField</span><span class="s0">, </span><span class="s1">timeLabel</span><span class="s0">, </span><span class="s1">timeField</span><span class="s0">, </span><span class="s1">phnLabel</span><span class="s0">, </span><span class="s1">phnField</span><span class="s0">, </span><span class="s1">frame</span><span class="s0">, </span><span class="s1">submitButton)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: an appointment, a JFrame</span>
    <span class="s3">// MODIFIES: this</span>
    <span class="s3">// EFFECTS:  adds the appointment and saves the data as per user's choice and then displays appropriate</span>
    <span class="s3">//           user message</span>
    <span class="s0">private void </span><span class="s1">appMessage(Appointment newAppointment</span><span class="s0">, </span><span class="s1">JFrame frame) {</span>
        <span class="s1">appointments.addAppointment(newAppointment)</span><span class="s0">;</span>
        <span class="s1">JOptionPane.showMessageDialog(frame</span><span class="s0">, </span><span class="s4">&quot;Appointment Scheduled successfully&quot;</span><span class="s0">, </span><span class="s4">&quot;Success&quot;</span><span class="s0">,</span>
                <span class="s1">JOptionPane.INFORMATION_MESSAGE</span><span class="s0">, new </span><span class="s1">ImageIcon(logo))</span><span class="s0">;</span>

        <span class="s0">int </span><span class="s1">option = JOptionPane.showConfirmDialog(frame</span><span class="s0">, </span><span class="s4">&quot;Do you want to save the data?&quot;</span><span class="s0">, </span><span class="s4">&quot;Save data&quot;</span><span class="s0">,</span>
                <span class="s1">JOptionPane.YES_NO_OPTION)</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(option == JOptionPane.YES_OPTION) {</span>
            <span class="s0">try </span><span class="s1">{</span>
                <span class="s1">appointmentFile.writeAppointmentsToFile(appointments.getAppointments())</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">catch </span><span class="s1">(IOException ex) {</span>
                <span class="s0">throw new </span><span class="s1">RuntimeException(ex)</span><span class="s0">;</span>
            <span class="s1">}</span>
            <span class="s1">JOptionPane.showMessageDialog(frame</span><span class="s0">, </span><span class="s4">&quot;Data saved successfully!&quot;</span><span class="s0">, </span><span class="s4">&quot;Success&quot;</span><span class="s0">,</span>
                    <span class="s1">JOptionPane.INFORMATION_MESSAGE</span><span class="s0">, new </span><span class="s1">ImageIcon(logo))</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: a valid JFrame</span>
    <span class="s3">// EFFECTS: displays the patient not found pop-up</span>
    <span class="s0">private void </span><span class="s1">patientNotFoundMessage(JFrame frame) {</span>
        <span class="s1">JOptionPane.showMessageDialog(frame</span><span class="s0">, </span><span class="s4">&quot;Patient Not Found!&quot;</span><span class="s0">, </span><span class="s4">&quot;Failure&quot;</span><span class="s0">,</span>
                <span class="s1">JOptionPane.INFORMATION_MESSAGE</span><span class="s0">,</span>
                <span class="s0">new </span><span class="s1">ImageIcon(logo))</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: a valid JFrame</span>
    <span class="s3">// EFFECTS: displays the already has appointment pop-up</span>
    <span class="s0">private void </span><span class="s1">patientAlreadyHasAppointmentMessage(JFrame frame) {</span>
        <span class="s1">JOptionPane.showMessageDialog(frame</span><span class="s0">, </span><span class="s4">&quot;Patient Already has an appointment&quot;</span><span class="s0">,</span>
                <span class="s4">&quot;Failure&quot;</span><span class="s0">,</span>
                <span class="s1">JOptionPane.INFORMATION_MESSAGE</span><span class="s0">,</span>
                <span class="s0">new </span><span class="s1">ImageIcon(logo))</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: a valid JFrame</span>
    <span class="s3">// EFFECTS: displays appointment clashes with another appointment message</span>
    <span class="s0">private void </span><span class="s1">appointmentClashesWithAnotherMessage(JFrame frame) {</span>
        <span class="s1">JOptionPane.showMessageDialog(frame</span><span class="s0">, </span><span class="s4">&quot;Appointment clashes with another appointment&quot;</span><span class="s0">,</span>
                <span class="s4">&quot;Failure&quot;</span><span class="s0">,</span>
                <span class="s1">JOptionPane.INFORMATION_MESSAGE</span><span class="s0">,</span>
                <span class="s0">new </span><span class="s1">ImageIcon(logo))</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: all the valid fields required to make the panel</span>
    <span class="s3">// EFFECTS: sets the specifications of the panel</span>
    <span class="s0">private void </span><span class="s1">makePanel(JLabel dateLabel</span><span class="s0">, </span><span class="s1">JTextField dateField</span><span class="s0">, </span><span class="s1">JLabel timeLabel</span><span class="s0">, </span><span class="s1">JTextField timeField</span><span class="s0">,</span>
                           <span class="s1">JLabel phnLabel</span><span class="s0">,</span>
                           <span class="s1">JTextField phnField</span><span class="s0">, </span><span class="s1">JFrame frame</span><span class="s0">, </span><span class="s1">JButton submitButton) {</span>
        <span class="s1">JPanel panel = </span><span class="s0">new </span><span class="s1">JPanel(</span><span class="s0">new </span><span class="s1">GridLayout(</span><span class="s5">4</span><span class="s0">, </span><span class="s5">2</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">panel.add(dateLabel)</span><span class="s0">;</span>
        <span class="s1">panel.add(dateField)</span><span class="s0">;</span>
        <span class="s1">panel.add(timeLabel)</span><span class="s0">;</span>
        <span class="s1">panel.add(timeField)</span><span class="s0">;</span>
        <span class="s1">panel.add(phnLabel)</span><span class="s0">;</span>
        <span class="s1">panel.add(phnField)</span><span class="s0">;</span>
        <span class="s1">panel.add(submitButton)</span><span class="s0">;</span>
        <span class="s1">frame.add(panel)</span><span class="s0">;</span>
        <span class="s1">frame.pack()</span><span class="s0">;</span>
        <span class="s1">frame.setVisible(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: a valid PHN</span>
    <span class="s3">// EFFECTS: returns Patient object if it exists, null otherwise</span>
    <span class="s0">private </span><span class="s1">Patient getPatientFromPHN(</span><span class="s0">int </span><span class="s1">phn) {</span>
        <span class="s0">for </span><span class="s1">(Patient p : patients) {</span>
            <span class="s0">if </span><span class="s1">(p.getPhn() == phn) {</span>
                <span class="s0">return </span><span class="s1">p</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s0">return null;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: a valid date and time</span>
    <span class="s3">// EFFECTS: returns true if the given date and time overlap with another appointment</span>
    <span class="s0">private boolean </span><span class="s1">overlaps(LocalDate date</span><span class="s0">, </span><span class="s1">LocalTime time) {</span>
        <span class="s0">for </span><span class="s1">(Appointment a: appointments.getAppointments()) {</span>
            <span class="s0">if </span><span class="s1">(a.getDate().equals(date) &amp;&amp; a.getTime().equals(time)) {</span>
                <span class="s0">return true;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s0">return false;</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: patient, frame, phnField, date and time</span>
    <span class="s3">// EFFECTS: handles the patient details, takes the appropriate action and display appropriate message</span>
    <span class="s0">private void </span><span class="s1">handlePatient(Patient patient</span><span class="s0">, </span><span class="s1">JFrame frame</span><span class="s0">, </span><span class="s1">JTextField phnField</span><span class="s0">, </span><span class="s1">LocalDate date</span><span class="s0">, </span><span class="s1">LocalTime time) {</span>
        <span class="s0">if </span><span class="s1">(patient == </span><span class="s0">null</span><span class="s1">) {</span>
            <span class="s1">patientNotFoundMessage(frame)</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s1">Appointment newAppointment = </span><span class="s0">new </span><span class="s1">Appointment(date</span><span class="s0">, </span><span class="s1">time</span><span class="s0">, </span><span class="s1">patient)</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(appointments.findAppointment(Integer.parseInt(phnField.getText())) != </span><span class="s0">null</span><span class="s1">) {</span>
                <span class="s1">patientAlreadyHasAppointmentMessage(frame)</span><span class="s0">;</span>
                <span class="s0">if </span><span class="s1">(overlaps(date</span><span class="s0">, </span><span class="s1">time)) {</span>
                    <span class="s1">appointmentClashesWithAnotherMessage(frame)</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(overlaps(date</span><span class="s0">, </span><span class="s1">time)) {</span>
                <span class="s1">appointmentClashesWithAnotherMessage(frame)</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s1">appMessage(newAppointment</span><span class="s0">, </span><span class="s1">frame)</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">// REQUIRES: dateField, timeField, and phnField</span>
    <span class="s3">// EFFECTS: clears all the fields</span>
    <span class="s0">private void </span><span class="s1">clearFields(JTextField dateField</span><span class="s0">, </span><span class="s1">JTextField timeField</span><span class="s0">, </span><span class="s1">JTextField phnField) {</span>
        <span class="s1">dateField.setText(</span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">timeField.setText(</span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">phnField.setText(</span><span class="s4">&quot;&quot;</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>
</pre>
</body>
</html>